!function(t){function e(e,r){var s=r.Canvas;null==i&&(n=s.prototype.getTextInfo,o=s.prototype.addText,i=s.prototype.render),s.prototype.render=function(){if(!e.getOptions().canvas)return i.call(this);var t=this.context,n=this._textCache;t.save(),t.textBaseline="middle";for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var r=n[o];for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){var a=r[s],l=!0;for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)){var p=a[h],f=p.positions,c=p.lines;l&&(t.fillStyle=p.font.color,t.font=p.font.definition,l=!1);for(var v,d=0;v=f[d];d++)if(v.active)for(var g,u=0;g=v.lines[u];u++)t.fillText(c[u].text,g[0],g[1]);else f.splice(d--,1);0===f.length&&delete a[h]}}}t.restore()},s.prototype.getTextInfo=function(i,o,r,s,a){if(!e.getOptions().canvas)return n.call(this,i,o,r,s,a);var l,h,p,f;if(o=""+o,l="object"==typeof r?r.style+" "+r.variant+" "+r.weight+" "+r.size+"px "+r.family:r,h=this._textCache[i],null==h&&(h=this._textCache[i]={}),p=h[l],null==p&&(p=h[l]={}),f=p[o],null==f){var c=this.context;if("object"!=typeof r){var v=t("<div>&nbsp;</div>").css("position","absolute").addClass("string"==typeof r?r:null).appendTo(this.getTextLayer(i));r={lineHeight:v.height(),style:v.css("font-style"),variant:v.css("font-variant"),weight:v.css("font-weight"),family:v.css("font-family"),color:v.css("color")},r.size=v.css("line-height",1).height(),v.remove()}l=r.style+" "+r.variant+" "+r.weight+" "+r.size+"px "+r.family,f=p[o]={width:0,height:0,positions:[],lines:[],font:{definition:l,color:r.color}},c.save(),c.font=l;for(var d=(o+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n"),g=0;g<d.length;++g){var u=d[g],y=c.measureText(u);f.width=Math.max(y.width,f.width),f.height+=r.lineHeight,f.lines.push({text:u,width:y.width,height:r.lineHeight})}c.restore()}return f},s.prototype.addText=function(t,i,n,r,s,a,l,h,p){if(!e.getOptions().canvas)return o.call(this,t,i,n,r,s,a,l,h,p);var f=this.getTextInfo(t,r,s,a,l),c=f.positions,v=f.lines;n+=f.height/v.length/2,n="middle"===p?Math.round(n-f.height/2):"bottom"===p?Math.round(n-f.height):Math.round(n),window.opera&&window.opera.version().split(".")[0]<12&&(n-=2);for(var d,g=0;d=c[g];g++)if(d.x===i&&d.y===n)return void(d.active=!0);d={active:!0,lines:[],x:i,y:n},c.push(d);for(var u,y=0;u=v[y];y++)"center"===h?d.lines.push([Math.round(i-u.width/2),n]):"right"===h?d.lines.push([Math.round(i-u.width),n]):d.lines.push([Math.round(i),n]),n+=u.height}}var i,n,o,r={canvas:!0};t.plot.plugins.push({init:e,options:r,name:"canvas",version:"1.0"})}(jQuery);