!function(e){function l(e){return"undefined"!=typeof n?new n(e):null}function a(e,l){return l%e}function t(e,l){return Math.floor(l/e)}function o(e){return e*Math.PI}function r(e,l,a,t,o,r,g,n,s,i){if(r!==g){var u=!1;e.save(),e.beginPath(),e.arc(l,a,t,r,g,u),e.lineTo(l+(t-o)*Math.cos(g),a+(t-o)*Math.sin(g)),e.arc(l,a,t-o,g,r,!u),e.closePath(),s&&(e.lineWidth=s),n&&(e.strokeStyle=n,e.stroke()),i&&(e.fillStyle=i,e.fill()),e.restore()}}function g(a){a.hooks.processOptions.push(function(e,a){var t=l(a.series.gauges.debug);t.log("flot.gauge.processOptions"),t.log("options=",a),a.series.gauges.show&&(a.grid.show=!1,a.legend.show=!1);var o=a.series.gauges.threshold.values;t.log("thresholds=",o),o.sort(function(e,l){return e.value<l.value?-1:e.value>l.value?1:0}),t.log("thresholds(sorted)=",o),t.log("options=",a)}),a.hooks.draw.push(function(a,t){var o=a.getOptions(),r=o.series.gauges,g=l(r.debug);if(g.log("flot.gauge.draw"),r.show){var n=a.getData();if(g.log("series=",n),n&&n.length){var i=new s(a,t),u=i.calculateLayout();g.log("layout=",u),r.debug.layout&&g.debugLayout(t,n.length,u),i.drawBackground(u);for(var h=0;h<n.length;h++){var c=n[h];g.log("item["+h+"]=",c);var d=e.extend({},r,c.gauges);c.gauges&&i.calculateAutoValues(d,u.cellWidth),g.log("gaugeOptions["+h+"]=",d);var f=i.calculateCellLayout(d,u,h);g.log("cellLayout=",f),i.drawCellBackground(d,f),d.debug.layout&&g.debugCellLayout(t,d,u,f),d.label.show&&i.drawLable(d,u,f,h,c),i.drawGauge(d,u,f,c.label,c.data[0][1]),d.threshold.show&&i.drawThreshold(d,u,f),d.threshold.label.show&&i.drawThresholdValues(d,u,f,h),d.value.show&&i.drawValue(d,u,f,h,c)}}}})}var n=function(){var e=function(l){var a;a=l.log?window.console&&console.log?console.log.bind?console.log.bind(console):function(){var e=Array.prototype.join.apply(arguments,[""]);console.log(e)}:l.alert?function(){var e=Array.prototype.join.apply(arguments,[""]);alert(e)}:function(){}:function(){},e.prototype.log=a};return e.prototype.debugLayout=function(e,l,o){e.save(),e.strokeStyle="gray",e.lineWidth=1,e.strokeRect(0,0,o.canvasWidth,o.canvasHeight);for(var r=0;l>r;r++){var g=a(o.columns,r),n=t(o.columns,r);e.strokeRect(o.margin+o.cellWidth*g+o.hMargin*g,o.margin+o.cellHeight*n+o.vMargin*n,o.cellWidth,o.cellHeight)}e.restore()},e.prototype.debugCellLayout=function(e,l,a,t){if(e.save(),e.strokeStyle="gray",e.lineWidth=1,l.label.show){var g=t.cellWidth/3+2*a.labelMargin,n=a.labelFontSize+2*a.labelMargin,s=t.cellWidth/3,i=a.labelFontSize;e.strokeRect(t.cx-g/2,t.y+t.cellMargin+t.offsetY,g,n),e.strokeRect(t.cx-s/2,t.y+t.cellMargin+a.labelMargin+t.offsetY,s,i)}if(l.value.show){var u=t.cellWidth/3+2*a.valueMargin,h=a.valueFontSize+2*a.valueMargin,c=t.cellWidth/3,d=a.valueFontSize;e.strokeRect(t.cx-u/2,t.cy-h/2,u,h),e.strokeRect(t.cx-c/2,t.cy-d/2,c,d)}e.strokeRect(t.cx,t.cy,1,1),e.strokeRect(t.x+t.cellMargin,t.y+t.cellMargin+n+t.offsetY,t.cellWidth-2*t.cellMargin,a.gaugeOuterHeight),r(e,t.cx,t.cy,a.radius,a.width,o(l.gauge.startAngle),o(l.gauge.endAngle),e.strokeStyle),l.threshold.show&&r(e,t.cx,t.cy,a.radius+a.thresholdWidth,a.thresholdWidth,o(l.gauge.startAngle),o(l.gauge.endAngle),e.strokeStyle),l.threshold.label.show&&r(e,t.cx,t.cy,a.radius+a.thresholdWidth+a.thresholdLabelFontSize+2*a.thresholdLabelMargin,a.thresholdLabelFontSize+2*a.thresholdLabelMargin,o(l.gauge.startAngle),o(l.gauge.endAngle),e.strokeStyle),e.restore()},e}(),s=function(){function g(e,l){y.log("flot.gauge.calculateAutoValues"),"auto"===e.gauge.width&&(e.gauge.width=Math.max(5,l/8)),"auto"===e.label.margin&&(e.label.margin=Math.max(1,l/20)),"auto"===e.label.font.size&&(e.label.font.size=Math.max(5,l/8)),"auto"===e.value.margin&&(e.value.margin=Math.max(1,l/30)),"auto"===e.value.font.size&&(e.value.font.size=Math.max(5,l/9)),"auto"===e.threshold.width&&(e.threshold.width=Math.max(3,l/100)),"auto"===e.threshold.label.margin&&(e.threshold.label.margin=Math.max(3,l/40)),"auto"===e.threshold.label.font.size&&(e.threshold.label.font.size=Math.max(5,l/15)),y.log("gaugeOptions=",e)}function n(e,l){for(var a,t=0;t<e.threshold.values.length;t++){var o=e.threshold.values[t];if(a=o.color,l<=o.value)break}return a}function s(e,l,a){var t=e.gauge.startAngle+(e.gauge.endAngle-e.gauge.startAngle)*((a-e.gauge.min)/(e.gauge.max-e.gauge.min));return t<e.gauge.startAngle?t=e.gauge.startAngle:t>e.gauge.endAngle&&(t=e.gauge.endAngle),t}function i(e,l,a,t,o,g,n,s,i,u){o!==g&&(c.save(),r(c,e,l,a,t,o,g,n,s,i),u&&(r(c,e,l,a,t,o,g),c.clip(),c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=10,c.shadowColor="gray",r(c,e,l,a+1,t+2,o,g,n,1)),c.restore())}function u(e,l,a,t,r,g){h(a.cx+(l.thresholdLabelMargin+l.thresholdLabelFontSize/2+l.radius)*Math.cos(o(g)),a.cy+(l.thresholdLabelMargin+l.thresholdLabelFontSize/2+l.radius)*Math.sin(o(g)),"flotGagueThresholdValue"+t,e.threshold.label.formatter?e.threshold.label.formatter(r):r,e.threshold.label,g)}function h(l,a,t,o,r,g){var n=e("#"+t),s=n.length;s||(n=e("<span></span>"),n.attr("id",t),n.css("position","absolute"),n.css("top",a+"px"),r.font.size&&n.css("font-size",r.font.size+"px"),r.font.family&&n.css("font-family",r.font.family),r.color&&n.css("color",r.color),r.background.color&&n.css("background-color",r.background.color),r.background.opacity&&n.css("opacity",r.background.opacity),d.append(n)),n.text(o),n.css("left",l+"px"),n.css("left",parseInt(n.css("left"))-n.width()/2+"px"),!s&&g&&(n.css("top",parseInt(n.css("top"))-n.height()/2+"px"),n.css("transform","rotate("+(180*g+90)+"deg)"))}var c,d,f,v,b,y,w=function(e,a){c=a,d=e.getPlaceholder(),f=e.getOptions(),v=f.series.gauges,b=e.getData(),y=l(v.debug)};return w.prototype.calculateLayout=function(){y.log("flot.gauge.calculateLayout");var e=d.width(),l=d.height();y.log("canvasWidth=",e),y.log("canvasHeight=",l);var a=Math.min(b.length,v.layout.columns),t=Math.ceil(b.length/a);y.log("columns=",a),y.log("rows=",t);var r=v.layout.margin,n=v.layout.hMargin,s=v.layout.vMargin,i=(e-2*r-n*(a-1))/a,u=(l-2*r-s*(t-1))/t;if(v.layout.square){var h=Math.min(i,u);i=h,u=h}y.log("cellWidth=",i),y.log("cellHeight=",u),g(v,i);var c=v.cell.margin,f=0,w=0;v.label.show&&(f=v.label.margin,w=v.label.font.size);var m=0,p=0;v.value.show&&(m=v.value.margin,p=v.value.font.size);var M=0;v.threshold.show&&(M=v.threshold.width);var k=0,x=0;v.threshold.label.show&&(k=v.threshold.label.margin,x=v.threshold.label.font.size);for(var W=i/2-c-M-2*k-x,A=v.gauge.startAngle,z=v.gauge.endAngle,L=(z-A)/100,S=-1,H=A;z>H;H+=L)S=Math.max(S,Math.sin(o(H)));S=Math.max(S,Math.sin(o(z)));var F=(u-2*c-2*f-w)/(1+S);m+p/2>F*S&&(F=u-2*c-2*f-w-m-p/2);var C=F-2*k-x-M,R=Math.min(W,C);y.log("radius=",R);var O=v.gauge.width;O>=R&&(O=Math.max(3,R/3)),y.log("width=",O);var V=2*k+x+M+R,T=Math.max(V*(1+S),V+m+p/2);return{canvasWidth:e,canvasHeight:l,margin:r,hMargin:n,vMargin:s,columns:a,rows:t,cellWidth:i,cellHeight:u,cellMargin:c,labelMargin:f,labelFontSize:w,valueMargin:m,valueFontSize:p,width:O,radius:R,thresholdWidth:M,thresholdLabelMargin:k,thresholdLabelFontSize:x,gaugeOuterHeight:T}},w.prototype.calculateAutoValues=g,w.prototype.calculateCellLayout=function(e,l,o){y.log("flot.gauge.calculateCellLayout");var r=a(l.columns,o),g=t(l.columns,o),n=l.margin+(l.cellWidth+l.hMargin)*r,s=l.margin+(l.cellHeight+l.vMargin)*g,i=n+l.cellWidth/2,u=s+l.cellMargin+2*l.labelMargin+l.labelFontSize+l.thresholdWidth+l.thresholdLabelFontSize+2*l.thresholdLabelMargin+l.radius,h=l.cellHeight-2*l.cellMargin-2*l.labelMargin-l.labelFontSize-l.gaugeOuterHeight,c=0;return"middle"===e.cell.vAlign?c=h/2:"bottom"===e.cell.vAlign&&(c=h),u+=c,{col:r,row:g,x:n,y:s,offsetY:c,cellWidth:l.cellWidth,cellHeight:l.cellHeight,cellMargin:l.cellMargin,cx:i,cy:u}},w.prototype.drawBackground=function(e){y.log("flot.gauge.drawBackground"),v.frame.show&&(c.save(),c.strokeStyle=f.grid.borderColor,c.lineWidth=f.grid.borderWidth,c.strokeRect(0,0,e.canvasWidth,e.canvasHeight),f.grid.backgroundColor&&(c.fillStyle=f.grid.backgroundColor,c.fillRect(0,0,e.canvasWidth,e.canvasHeight)),c.restore())},w.prototype.drawCellBackground=function(e,l){y.log("flot.gauge.drawCellBackground"),c.save(),e.cell.border&&e.cell.border.show&&e.cell.border.color&&e.cell.border.width&&(c.strokeStyle=e.cell.border.color,c.lineWidth=e.cell.border.width,c.strokeRect(l.x,l.y,l.cellWidth,l.cellHeight)),e.cell.background&&e.cell.background.color&&(c.fillStyle=e.cell.background.color,c.fillRect(l.x,l.y,l.cellWidth,l.cellHeight)),c.restore()},w.prototype.drawGauge=function(e,l,a,t,r){y.log("flot.gauge.drawGauge");var g=e.gauge.shadow.show?e.gauge.shadow.blur:0;y.log("blur=",g),i(a.cx,a.cy,l.radius,l.width,o(e.gauge.startAngle),o(e.gauge.endAngle),e.gauge.border.color,e.gauge.border.width,e.gauge.background.color,g);var u=n(e,r),h=s(e,l,r);i(a.cx,a.cy,l.radius-1,l.width-2,o(e.gauge.startAngle),o(h),u,1,u,g)},w.prototype.drawThreshold=function(e,l,a){y.log("flot.gauge.drawThreshold");for(var t=e.gauge.startAngle,g=0;g<e.threshold.values.length;g++){var n=e.threshold.values[g];c1=n.color,a2=s(e,l,n.value),r(c,a.cx,a.cy,l.radius+l.thresholdWidth,l.thresholdWidth-2,o(t),o(a2),c1,1,c1),t=a2}},w.prototype.drawLable=function(e,l,a,t,o){y.log("flot.gauge.drawLable"),h(a.cx,a.y+a.cellMargin+l.labelMargin+a.offsetY,"flotGagueLabel"+t,e.label.formatter?e.label.formatter(o.label,o.data[0][1]):text,e.label)},w.prototype.drawValue=function(e,l,a,t,o){y.log("flot.gauge.drawValue"),h(a.cx,a.cy-e.value.font.size/2,"flotGagueValue"+t,e.value.formatter?e.value.formatter(o.label,o.data[0][1]):text,e.value)},w.prototype.drawThresholdValues=function(e,l,a,t){y.log("flot.gauge.drawThresholdValues"),u(e,l,a,"Min"+t,e.gauge.min,e.gauge.startAngle),u(e,l,a,"Max"+t,e.gauge.max,e.gauge.endAngle);for(var o=0;o<e.threshold.values.length;o++){var r=e.threshold.values[o];if(r.value>e.gauge.min&&r.value<e.gauge.max){var g=s(e,l,r.value);u(e,l,a,t+"_"+o,r.value,g)}}},w}(),i={series:{gauges:{debug:{log:!1,layout:!1,alert:!1},show:!1,layout:{margin:5,columns:3,hMargin:5,vMargin:5,square:!1},frame:{show:!0},cell:{background:{color:null},border:{show:!0,color:"black",width:1},margin:5,vAlign:"middle"},gauge:{width:"auto",startAngle:.9,endAngle:2.1,min:0,max:100,background:{color:"white"},border:{color:"lightgray",width:2},shadow:{show:!0,blur:5}},label:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:"sans-serif"},color:null,formatter:function(e,l){return e}},value:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:"sans-serif"},color:null,formatter:function(e,l){return parseInt(l)}},threshold:{show:!0,width:"auto",label:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:",sans-serif"},color:null,formatter:function(e){return e}},values:[{value:50,color:"lightgreen"},{value:80,color:"yellow"},{value:100,color:"red"}]}}}};e.plot.plugins.push({init:g,options:i,name:"gauge",version:"1.1.0"})}(jQuery);