!function(e){function t(t){function o(e){g.active&&(a(e),t.getPlaceholder().trigger("plotselecting",[s()]),g.touch===!0&&e.preventDefault())}function n(t){if("touchstart"===t.type&&1===t.originalEvent.touches.length)g.touch=!0;else if(1!==t.which||t.originalEvent.touches&&t.originalEvent.touches.length>1)return;document.body.focus(),void 0!==document.onselectstart&&null===m.onselectstart&&(m.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null===m.ondrag&&(m.ondrag=document.ondrag,document.ondrag=function(){return!1}),l(g.first,t),g.active=!0,x=function(e){i(e)},e(document).one(g.touch?"touchend":"mouseup",x)}function i(e){return x=null,void 0!==document.onselectstart&&(document.onselectstart=m.onselectstart),void 0!==document.ondrag&&(document.ondrag=m.ondrag),g.active=!1,a(e),h()?r():(t.getPlaceholder().trigger("plotunselected",[]),t.getPlaceholder().trigger("plotselecting",[null])),g.touch=!1,!1}function s(){if(!h()||!g.show)return null;var o={},n=g.first,i=g.second;return e.each(t.getAxes(),function(e,t){if(t.used){var s=t.c2p(n[t.direction]),r=t.c2p(i[t.direction]);o[e]={from:Math.min(s,r),to:Math.max(s,r)}}}),o}function r(){var e=s();t.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&t.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function c(e,t,o){return e>t?e:t>o?o:t}function l(e,o){var n=t.getOptions(),i=t.getPlaceholder().offset(),s=t.getPlotOffset(),r=g.touch?o.originalEvent.changedTouches[0]:o;e.x=c(0,r.pageX-i.left-s.left,t.width()),e.y=c(0,r.pageY-i.top-s.top,t.height()),"y"===n.selection.mode&&(e.x=e===g.first?0:t.width()),"x"===n.selection.mode&&(e.y=e===g.first?0:t.height())}function a(e){var o=g.touch?e.originalEvent.changedTouches[0]:e;null!==o.pageX&&(l(g.second,e),h()?(g.show=!0,t.triggerRedrawOverlay()):u(!0))}function u(e){g.show&&(g.show=!1,t.triggerRedrawOverlay(),e||t.getPlaceholder().trigger("plotunselected",[]))}function d(e,o){var n,i,s,r,c=t.getAxes();for(var l in c)if(Object.prototype.hasOwnProperty.call(c,l)&&(n=c[l],n.direction===o&&(r=o+n.n+"axis",e[r]||1!==n.n||(r=o+"axis"),e[r]))){i=e[r].from,s=e[r].to;break}if(e[r]||(n="x"===o?t.getXAxes()[0]:t.getYAxes()[0],i=e[o+"1"],s=e[o+"2"]),null!=i&&null!=s&&i>s){var a=i;i=s,s=a}return{from:i,to:s,axis:n}}function f(e,o){var n,i=t.getOptions();"y"===i.selection.mode?(g.first.x=0,g.second.x=t.width()):(n=d(e,"x"),g.first.x=n.axis.p2c(n.from),g.second.x=n.axis.p2c(n.to)),"x"===i.selection.mode?(g.first.y=0,g.second.y=t.height()):(n=d(e,"y"),g.first.y=n.axis.p2c(n.from),g.second.y=n.axis.p2c(n.to)),g.show=!0,t.triggerRedrawOverlay(),!o&&h()&&r()}function h(){var e=t.getOptions().selection.minSize;return Math.abs(g.second.x-g.first.x)>=e&&Math.abs(g.second.y-g.first.y)>=e}var g={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1,touch:!1},m={},x=null;t.clearSelection=u,t.setSelection=f,t.getSelection=s,t.hooks.bindEvents.push(function(e,t){var i=e.getOptions();null!=i.selection.mode&&(t.mousemove(o),t.mousedown(n),t.bind("touchstart",function(e){t.unbind("mousedown",n),n(e)}),t.bind("touchmove",o))}),t.hooks.drawOverlay.push(function(t,o){if(g.show&&h()){var n,i,s,r,c,l=t.getPlotOffset(),a=t.getOptions();o.save(),o.translate(l.left,l.top),n=e.color.parse(a.selection.color),o.strokeStyle=n.scale("a",.8).toString(),o.lineWidth=1,o.lineJoin=a.selection.shape,o.fillStyle=n.scale("a",.4).toString(),i=Math.min(g.first.x,g.second.x)+.5,s=Math.min(g.first.y,g.second.y)+.5,r=Math.abs(g.second.x-g.first.x)-1,c=Math.abs(g.second.y-g.first.y)-1,o.fillRect(i,s,r,c),o.strokeRect(i,s,r,c),o.restore()}}),t.hooks.shutdown.push(function(t,i){i.unbind("mousemove",o),i.unbind("mousedown",n),x&&e(document).unbind("mouseup",x)})}e.plot.plugins.push({init:t,options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);